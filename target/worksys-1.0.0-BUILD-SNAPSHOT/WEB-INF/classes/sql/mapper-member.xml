<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0/EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Member">

	<resultMap id="UserResult" type="UserVO">
		<result property="userCode" 	column="USER_CODE" />
		<result property="deptCode" 	column="DEPT_CODE" />
		<result property="deptNm" 	column="DEPT_NM" />
		<result property="userNm" 		column="USER_NM" />
		<result property="userID" 		column="USER_ID"/>
		<result property="password" 	column="PASSWORD" />
		<result property="position" 	column="POSITION" />
		<result property="state" 		column="STATE" />
		<result property="rgstDay" 		column="RGST_DAY" />
	</resultMap>

	<select id="listUser" resultMap="UserResult">
        SELECT 
            a.USER_CODE,
            b.DEPT_NM AS DEPT_CODE,
            a.USER_NM,
            a.USER_ID,
            a.POSITION,
            a.STATE,
            a.RGST_DAY
        FROM USER_MGMT a, DEPT_MGMT b
        WHERE a.DEPT_CODE = b.DEPT_CODE
        ORDER BY a.USER_NM ASC
	</select>
	
	<select id="getDeptUserList" resultMap="UserResult" parameterType="UserVO">
        SELECT 
            a.USER_CODE,
            b.DEPT_NM AS DEPT_CODE,
            a.USER_NM,
            a.USER_ID,
            a.POSITION,
            a.STATE,
            a.RGST_DAY
        FROM USER_MGMT a, DEPT_MGMT b
        WHERE a.DEPT_CODE = b.DEPT_CODE
        
        <if test="deptCode != '' and deptCode != null">
        AND a.DEPT_CODE = #{deptCode}
        </if>
        
        <if test="deptParent != '' and deptParent != null">
        AND b.DEPT_PARENT = #{deptParent}
        </if>
        
        ORDER BY a.USER_NM ASC
	</select>
	
	<select id="getUser" parameterType="UserVO" resultMap="UserResult">
        SELECT 
            a.USER_CODE,
            b.DEPT_NM,
            b.DEPT_CODE,
            a.USER_NM,
            a.USER_ID,
            a.POSITION,
            a.STATE,
            a.RGST_DAY
        FROM USER_MGMT a, DEPT_MGMT b
        WHERE a.DEPT_CODE = b.DEPT_CODE
		AND USER_CODE = #{userCode}
	</select>

	<insert id="userInsertInfo" parameterType="UserVO">
		INSERT INTO USER_MGMT (
			USER_CODE
			, DEPT_CODE
			, USER_NM
			, USER_ID
			, PASSWORD
			, POSITION
			, STATE
			, RGST_DAY
			, MODI_DT
		) 
		VALUES (
			'UM'||lpad(USER_SEQ.nextval,4,0)
			, #{deptCode}
			, #{userNm}
			, #{userID}
			, #{password}
			, #{position}
			, #{state}
			, SYSDATE
			, SYSTIMESTAMP
		)
	</insert>
	
	<update id="updateUserInfo" parameterType="UserVO">
		UPDATE USER_MGMT 
        SET 
            USER_CODE 	= #{userCode}
            , DEPT_CODE = #{deptCode}
            , USER_NM 	= #{userNm}
            , USER_ID 	= #{userID}
            
            <if test="password != '' and password != null">
            , PASSWORD 	= #{password} 
            </if>
            
            , POSITION 	= #{position}
            , STATE 	= #{state}
            , MODI_DT	= SYSTIMESTAMP
        WHERE USER_CODE = #{userCode}
	</update>
	
	<delete id="deleteuserInfo" parameterType="UserVO">
		DELETE FROM USER_MGMT
		WHERE USER_CODE = #{userCode}
	</delete>

</mapper>