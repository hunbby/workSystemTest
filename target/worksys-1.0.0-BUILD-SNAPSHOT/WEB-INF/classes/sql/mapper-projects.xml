<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0/EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Projects">

	<resultMap id="ProjectResult" type="ProjectVO">
        <result property="pjtCode" column="PJT_CODE" />
        <result property="epCode" column="EP_CODE" />
        <result property="epNm" column="EP_NM" />
        <result property="userCode" column="USER_CODE" />
        <result property="epMgmtNm" column="EP_MGMT_NM" />
        <result property="pjtNm" column="PJT_NM" />
        <result property="pjtTermTo" column="PJT_TERM_TO" />
        <result property="pjtTermFrom" column="PJT_TERM_FROM" />
        <result property="rgstDay" column="RGST_DAY" />
        <result property="userNm" column="USER_NM" />
        <result property="pjtParti" column="PJT_PARTI" />
	</resultMap>

	<insert id="insertProject" parameterType="map">
        INSERT INTO PJT_MGMT (
            PJT_CODE
            , EP_CODE
            , USER_CODE
            , PJT_NM
            , PJT_TERM_TO
            , PJT_TERM_FROM
            , PJT_PARTI
            , RGST_DAY
            , MODI_DT
        ) 
        VALUES (
            'PJ'||lpad(PJT_SEQ.nextval,4,0)
            , #{epCode}
            , #{userCode}
            , #{pjtNm}
            , #{pjtTermTo}
            , #{pjtTermFrom}
            , #{pjtParti}
            , SYSTIMESTAMP
            , SYSTIMESTAMP
		)
	</insert>

    <select id="listProject" resultMap="ProjectResult">
        SELECT 
            a.PJT_CODE
            , a.PJT_NM
            , b.EP_NM
            , b.EP_MGMT_NM
            , c.USER_NM
            , TO_CHAR(TO_DATE(a.PJT_TERM_TO,'YYYYMMDD'),'YYYY-MM-DD') AS PJT_TERM_TO
            , TO_CHAR(TO_DATE(a.PJT_TERM_FROM,'YYYYMMDD'),'YYYY-MM-DD') AS PJT_TERM_FROM
            , TO_CHAR(a.RGST_DAY,'YYYY-MM-DD HH24:MI:SS') AS  RGST_DAY
        FROM PJT_MGMT a, EP_MGMT b, USER_MGMT c
        WHERE a.EP_CODE = b.EP_CODE
        AND a.USER_CODE = c.USER_CODE
        ORDER BY a.RGST_DAY DESC
    </select>

    <select id="getProjectInfo"  parameterType="ProjectVO" resultMap="ProjectResult">
        SELECT 
            a.PJT_CODE
            , a.PJT_NM
            , a.EP_CODE
            , b.EP_NM
            , b.EP_MGMT_NM
            , c.USER_NM
            , a.USER_CODE
            , TO_CHAR(TO_DATE(a.PJT_TERM_TO,'YYYYMMDD'),'YYYY-MM-DD') AS PJT_TERM_TO
            , TO_CHAR(TO_DATE(a.PJT_TERM_FROM,'YYYYMMDD'),'YYYY-MM-DD') AS PJT_TERM_FROM
            , a.PJT_PARTI
            , TO_CHAR(a.RGST_DAY,'YYYY-MM-DD HH24:MI:SS') AS  RGST_DAY
        FROM PJT_MGMT a, EP_MGMT b, USER_MGMT c
        WHERE a.EP_CODE = b.EP_CODE
        AND a.USER_CODE = c.USER_CODE
        AND a.PJT_CODE = #{pjtCode}
    </select>

    <update id="updateProjectInfo" parameterType="java.util.HashMap">
        UPDATE PJT_MGMT SET 
            EP_CODE         = #{epCode},
            USER_CODE       = #{userCode},
            PJT_NM          = #{pjtNm},
            PJT_TERM_TO     = #{pjtTermTo},
            PJT_TERM_FROM   = #{pjtTermFrom},
            PJT_PARTI		= #{pjtParti},
            MODI_DT			= SYSTIMESTAMP
        WHERE PJT_CODE      = #{pjtCode}
    </update>

    <delete id="deleteProjectInfo" parameterType="java.util.HashMap">
        DELETE FROM PJT_MGMT WHERE PJT_CODE = #{pjtCode}
    </delete>

</mapper>